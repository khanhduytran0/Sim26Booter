set -e
cd $(realpath $HOME/../..)/iOSSimData/override

add_trustcache() {
    local path="$1"
    local cdhash
    cdhash=$(ldid -arch arm64 -h "$path" 2>/dev/null | grep CDHash= | cut -c8-)
    echo "Adding $path cdhash: $cdhash"
    jbctl trustcache add "$cdhash"
}

add_trustcache "sbin/ldfix.dylib"
add_trustcache "sbin/ltfix.dylib"
add_trustcache "System/Library/PrivateFrameworks/SimFramebuffer.framework/SimFramebuffer"
